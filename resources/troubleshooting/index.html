<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>KSML Troubleshooting Guide - KSML Documentation</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">KSML Documentation</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../tutorials/getting-started/" class="nav-link">Getting Started</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../core-concepts/" class="nav-link">Core Concepts</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../tutorials/" class="nav-link">Tutorials</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../use-cases/" class="nav-link">Use Case Guides</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../reference/" class="nav-link">Reference</a>
                            </li>
                            <li class="nav-item">
                                <a href="../" class="nav-link">Resources</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#ksml-troubleshooting-guide" class="nav-link">KSML Troubleshooting Guide</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#common-error-messages" class="nav-link">Common Error Messages</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#deployment-issues" class="nav-link">Deployment Issues</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#performance-issues" class="nav-link">Performance Issues</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#debugging-techniques" class="nav-link">Debugging Techniques</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#common-patterns-and-anti-patterns" class="nav-link">Common Patterns and Anti-Patterns</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#getting-help" class="nav-link">Getting Help</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#conclusion" class="nav-link">Conclusion</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="ksml-troubleshooting-guide">KSML Troubleshooting Guide</h1>
<p>This guide provides solutions for common issues you might encounter when working with KSML. It covers problems related to development, deployment, and runtime behavior.</p>
<h2 id="common-error-messages">Common Error Messages</h2>
<h3 id="syntax-errors">Syntax Errors</h3>
<h4 id="yaml-parsing-errors">YAML Parsing Errors</h4>
<p><strong>Error</strong>: <code>Error parsing YAML: mapping values are not allowed here</code></p>
<p><strong>Solution</strong>: Check your YAML indentation. YAML is sensitive to spaces and tabs. Make sure you're using consistent indentation (preferably spaces) throughout your KSML file.</p>
<pre><code class="language-yaml"># Incorrect
streams:
  my_stream:
  topic: my-topic  # Wrong indentation (topic should be indented under my_stream)

# Correct
streams:
  my_stream:
    topic: my-topic  # Proper indentation (topic is properly indented under my_stream)
</code></pre>
<p><strong>Error</strong>: <code>Error parsing YAML: found character that cannot start any token</code></p>
<p><strong>Solution</strong>: Look for special characters that might be causing issues. Common culprits include:
- Unescaped quotes within strings
- Special characters in keys or values
- Tab characters instead of spaces</p>
<h4 id="function-definition-errors">Function Definition Errors</h4>
<p><strong>Error</strong>: <code>Function 'process_data' is missing required parameter 'type'</code></p>
<p><strong>Solution</strong>: Ensure all functions have the required <code>type</code> parameter:</p>
<pre><code class="language-yaml">functions:
  process_data:
    # Missing type parameter
    parameters:
      - name: value
        type: object
    code: |
      return value
</code></pre>
<p>Correct version:</p>
<pre><code class="language-yaml">functions:
  process_data:
    type: mapValues  # Added type parameter
    parameters:
      - name: value
        type: object
    code: |
      return value
</code></pre>
<h4 id="pipeline-definition-errors">Pipeline Definition Errors</h4>
<p><strong>Error</strong>: <code>Pipeline 'my_pipeline' is missing required parameter 'from'</code></p>
<p><strong>Solution</strong>: Ensure all pipelines have the required <code>from</code> and <code>to</code> parameters:</p>
<pre><code class="language-yaml">pipelines:
  my_pipeline:
    # Missing 'from' parameter
    via:
      - type: mapValues
        mapper:
          code: transform_data(value)
    to: output_stream
</code></pre>
<p>Correct version:</p>
<pre><code class="language-yaml">pipelines:
  my_pipeline:
    from: input_stream  # Added 'from' parameter
    via:
      - type: mapValues
        mapper:
          code: transform_data(value)
    to: output_stream
</code></pre>
<h3 id="runtime-errors">Runtime Errors</h3>
<h4 id="serializationdeserialization-errors">Serialization/Deserialization Errors</h4>
<p><strong>Error</strong>: <code>Failed to deserialize key/value for topic 'my-topic'</code></p>
<p><strong>Solution</strong>: 
1. Check that the <code>keyType</code> and <code>valueType</code> in your stream definition match the actual data format in the Kafka topic
2. Verify that your data conforms to the expected schema
3. For Avro or other schema-based formats, ensure the schema is correctly registered and accessible</p>
<pre><code class="language-yaml">streams:
  my_stream:
    topic: my-topic
    keyType: string
    valueType: json  # Make sure this matches the actual data format
</code></pre>
<h4 id="python-code-errors">Python Code Errors</h4>
<p><strong>Error</strong>: <code>AttributeError: 'NoneType' object has no attribute 'get'</code></p>
<p><strong>Solution</strong>: Add null checks before accessing object properties:</p>
<pre><code class="language-python"># Incorrect
result = value.get(&quot;field&quot;).get(&quot;nested_field&quot;)

# Correct
result = None
if value is not None:
    field_value = value.get(&quot;field&quot;)
    if field_value is not None:
        result = field_value.get(&quot;nested_field&quot;)
</code></pre>
<p><strong>Error</strong>: <code>NameError: name 'some_variable' is not defined</code></p>
<p><strong>Solution</strong>: Ensure all variables are defined before use. Common issues include:
- Typos in variable names
- Using variables from outside the function scope
- Forgetting to import required modules</p>
<h4 id="join-operation-errors">Join Operation Errors</h4>
<p><strong>Error</strong>: <code>Stream 'reference_data' not found for join operation</code></p>
<p><strong>Solution</strong>: Verify that all streams referenced in join operations are defined:</p>
<pre><code class="language-yaml">streams:
  input_stream:
    topic: input-topic
    keyType: string
    valueType: json

  # Missing reference_data stream definition

pipelines:
  join_pipeline:
    from: input_stream
    via:
      - type: join
        with: reference_data  # This stream is not defined
    to: output_stream
</code></pre>
<p><strong>Error</strong>: <code>Join operation requires keys of the same type</code></p>
<p><strong>Solution</strong>: Ensure that the key types of streams being joined are compatible:</p>
<pre><code class="language-yaml">streams:
  orders:
    topic: orders
    keyType: string
    valueType: json

  products:
    topic: products
    keyType: long  # Different key type
    valueType: json
</code></pre>
<p>Correct version:</p>
<pre><code class="language-yaml">streams:
  orders:
    topic: orders
    keyType: string
    valueType: json

  products:
    topic: products
    keyType: string  # Same key type as orders
    valueType: json
</code></pre>
<h2 id="deployment-issues">Deployment Issues</h2>
<h3 id="configuration-problems">Configuration Problems</h3>
<p><strong>Error</strong>: <code>Failed to start KSML application: Could not connect to Kafka broker</code></p>
<p><strong>Solution</strong>:
1. Verify that the Kafka brokers are running and accessible
2. Check the <code>bootstrap.servers</code> configuration
3. Ensure network connectivity between the KSML application and Kafka brokers
4. Check firewall rules that might be blocking connections</p>
<pre><code class="language-yaml">configuration:
  bootstrap.servers: kafka:9092  # Make sure this is correct
</code></pre>
<p><strong>Error</strong>: <code>Topic 'my-topic' not found</code></p>
<p><strong>Solution</strong>:
1. Verify that the topic exists in your Kafka cluster
2. Check if you have the correct permissions to access the topic
3. Ensure the topic name is spelled correctly in your KSML definition</p>
<h3 id="resource-constraints">Resource Constraints</h3>
<p><strong>Error</strong>: <code>OutOfMemoryError: Java heap space</code></p>
<p><strong>Solution</strong>:
1. Increase the JVM heap size for the KSML runner
2. Review your stateful operations (joins, aggregations) for potential memory leaks
3. Consider using smaller time windows for windowed operations
4. Implement proper cleanup for state stores when they're no longer needed</p>
<pre><code class="language-bash"># Example of increasing heap size
java -Xmx2g -jar ksml-runner.jar
</code></pre>
<h2 id="performance-issues">Performance Issues</h2>
<h3 id="high-latency">High Latency</h3>
<p><strong>Symptom</strong>: Messages take a long time to process through the pipeline</p>
<p><strong>Solutions</strong>:
1. <strong>Optimize Python Code</strong>: Review your Python functions for inefficiencies
2. <strong>Reduce State Size</strong>: Minimize the amount of data stored in stateful operations
3. <strong>Adjust Parallelism</strong>: Increase the number of partitions for input topics
4. <strong>Monitor Resource Usage</strong>: Check CPU, memory, and network utilization
5. <strong>Simplify Complex Operations</strong>: Break down complex operations into simpler ones</p>
<h3 id="low-throughput">Low Throughput</h3>
<p><strong>Symptom</strong>: Pipeline processes fewer messages per second than expected</p>
<p><strong>Solutions</strong>:
1. <strong>Batch Processing</strong>: Use batch processing where appropriate
2. <strong>Optimize Serialization</strong>: Choose efficient serialization formats (e.g., Avro instead of JSON)
3. <strong>Reduce External Calls</strong>: Minimize calls to external systems
4. <strong>Caching</strong>: Implement caching for frequently accessed data
5. <strong>Horizontal Scaling</strong>: Run multiple instances of your KSML application</p>
<h2 id="debugging-techniques">Debugging Techniques</h2>
<h3 id="logging">Logging</h3>
<p>Add logging statements to your KSML functions to track execution:</p>
<pre><code class="language-yaml">- type: peek
  forEach:
    code: |
      log.info(&quot;Processing record: key={}, value={}&quot;, key, value)
</code></pre>
<p>For more detailed logging, you can include specific fields:</p>
<pre><code class="language-yaml">- type: peek
  forEach:
    code: |
      log.info(&quot;Order details: id={}, amount={}, customer={}&quot;,
               value.get(&quot;order_id&quot;),
               value.get(&quot;amount&quot;),
               value.get(&quot;customer_id&quot;))
</code></pre>
<h3 id="dead-letter-queues">Dead Letter Queues</h3>
<p>Implement dead letter queues to capture and analyze failed records:</p>
<pre><code class="language-yaml">streams:
  input:
    topic: input-topic
    keyType: string
    valueType: json

  output:
    topic: output-topic
    keyType: string
    valueType: json

  errors:
    topic: error-topic
    keyType: string
    valueType: json

pipelines:
  main_pipeline:
    from: input
    via:
      - type: mapValues
        mapper:
          code: process_data(value)
        onError:
          sendTo: errors
          withKey: key
          withValue: {&quot;original&quot;: value, &quot;error&quot;: exception.getMessage()}
    to: output
</code></pre>
<h3 id="testing-with-sample-data">Testing with Sample Data</h3>
<p>Create test pipelines that process a small sample of data:</p>
<pre><code class="language-yaml">streams:
  test_input:
    topic: test-input
    keyType: string
    valueType: json

  test_output:
    topic: test-output
    keyType: string
    valueType: json

pipelines:
  test_pipeline:
    from: test_input
    via:
      - type: peek
        forEach:
          code: |
            log.info(&quot;Input: {}&quot;, value)
      - type: mapValues
        mapper:
          code: process_data(value)
      - type: peek
        forEach:
          code: |
            log.info(&quot;Output: {}&quot;, value)
    to: test_output
</code></pre>
<h2 id="common-patterns-and-anti-patterns">Common Patterns and Anti-Patterns</h2>
<h3 id="recommended-patterns">Recommended Patterns</h3>
<h4 id="proper-error-handling">Proper Error Handling</h4>
<p>Always implement error handling to prevent pipeline failures:</p>
<pre><code class="language-yaml">- type: try
  operations:
    - type: mapValues
      mapper:
        code: process_data(value)
  catch:
    - type: mapValues
      mapper:
        code: |
          log.error(&quot;Failed to process data: {}&quot;, exception)
          return {&quot;error&quot;: str(exception), &quot;original&quot;: value}
</code></pre>
<h4 id="defensive-programming">Defensive Programming</h4>
<p>Always check for null values and handle edge cases:</p>
<pre><code class="language-python">def process_data(value):
    if value is None:
        return {&quot;error&quot;: &quot;Null input&quot;}

    user_id = value.get(&quot;user_id&quot;)
    if user_id is None:
        return {&quot;error&quot;: &quot;Missing user_id&quot;}

    # Process valid data
    return {&quot;user_id&quot;: user_id, &quot;processed&quot;: True}
</code></pre>
<h4 id="modular-functions">Modular Functions</h4>
<p>Break down complex logic into smaller, reusable functions:</p>
<pre><code class="language-yaml">functions:
  validate_input:
    type: mapValues
    parameters:
      - name: value
        type: object
    code: |
      # Validation logic

  transform_data:
    type: mapValues
    parameters:
      - name: value
        type: object
    code: |
      # Transformation logic

  enrich_data:
    type: mapValues
    parameters:
      - name: value
        type: object
      - name: reference
        type: object
    code: |
      # Enrichment logic

pipelines:
  main_pipeline:
    from: input
    via:
      - type: mapValues
        mapper:
          code: validate_input(value)
      - type: mapValues
        mapper:
          code: transform_data(value)
      - type: join
        with: reference_data
      - type: mapValues
        mapper:
          code: enrich_data(value, foreignValue)
    to: output
</code></pre>
<h3 id="anti-patterns-to-avoid">Anti-Patterns to Avoid</h3>
<h4 id="excessive-state">Excessive State</h4>
<p>Avoid storing large amounts of data in state stores:</p>
<pre><code class="language-yaml"># Anti-pattern: Storing entire message history
- type: aggregate
  initializer:
    expression: []
  aggregator:
    code: |
      if aggregate is None:
        return [value]
      else:
        return aggregate + [value]  # This will grow unbounded!
</code></pre>
<p>Better approach:</p>
<pre><code class="language-yaml"># Better: Store only what you need
- type: aggregate
  initializer:
    expression: {&quot;count&quot;: 0, &quot;sum&quot;: 0}
  aggregator:
    code: |
      if aggregate is None:
        return {&quot;count&quot;: 1, &quot;sum&quot;: value.get(&quot;amount&quot;, 0)}
      else:
        return {
          &quot;count&quot;: aggregate.get(&quot;count&quot;, 0) + 1,
          &quot;sum&quot;: aggregate.get(&quot;sum&quot;, 0) + value.get(&quot;amount&quot;, 0)
        }
</code></pre>
<h4 id="complex-single-functions">Complex Single Functions</h4>
<p>Avoid putting too much logic in a single function:</p>
<pre><code class="language-yaml"># Anti-pattern: Monolithic function
functions:
  do_everything:
    type: mapValues
    parameters:
      - name: value
        type: object
    code: |
      # 100+ lines of code that does validation, transformation,
      # business logic, error handling, etc.
</code></pre>
<h4 id="ignoring-errors">Ignoring Errors</h4>
<p>Don't ignore exceptions without proper handling:</p>
<pre><code class="language-yaml"># Anti-pattern: Swallowing exceptions
- type: mapValues
  mapper:
    code: |
      try:
        # Complex processing
        return process_result
      except:
        # Silently return empty result
        return {}
</code></pre>
<h2 id="getting-help">Getting Help</h2>
<p>If you're still experiencing issues after trying the solutions in this guide:</p>
<ol>
<li><strong>Check the Documentation</strong>: Review the <a href="../../reference/language-reference/">KSML Language Reference</a> and <a href="../../reference/operations-reference/">Operations Reference</a></li>
<li><strong>Search the Community Forums</strong>: Look for similar issues in the community forums</li>
<li><strong>Examine Logs</strong>: Check the KSML runner logs for detailed error information</li>
<li><strong>Create a Minimal Example</strong>: Create a simplified version of your pipeline that reproduces the issue</li>
<li><strong>Contact Support</strong>: Reach out to the KSML support team with:</li>
<li>A clear description of the issue</li>
<li>Steps to reproduce</li>
<li>Relevant logs and error messages</li>
<li>Your KSML definition file (with sensitive information removed)</li>
</ol>
<h2 id="conclusion">Conclusion</h2>
<p>Troubleshooting KSML applications involves understanding both the KSML language itself and the underlying Kafka Streams concepts. By following the patterns and solutions in this guide, you can resolve common issues and build more robust stream processing applications.</p>
<p>Remember that proper logging, error handling, and testing are key to identifying and resolving issues quickly. When in doubt, start with a simplified version of your pipeline and gradually add complexity while testing at each step.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
