<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Logging and Monitoring in KSML - KSML Documentation</title>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../../css/brands.min.css" rel="stylesheet">
        <link href="../../../css/solid.min.css" rel="stylesheet">
        <link href="../../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../..">KSML Documentation</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../getting-started/" class="nav-link">Getting Started</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../../core-concepts/" class="nav-link">Core Concepts</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../" class="nav-link">Tutorials</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../../use-cases/" class="nav-link">Use Case Guides</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../../reference/" class="nav-link">Reference</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../../resources/" class="nav-link">Resources</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#logging-and-monitoring-in-ksml" class="nav-link">Logging and Monitoring in KSML</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#prerequisites" class="nav-link">Prerequisites</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#what-youll-learn" class="nav-link">What You'll Learn</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#understanding-logging-in-ksml" class="nav-link">Understanding Logging in KSML</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#basic-logging-examples" class="nav-link">Basic Logging Examples</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#advanced-logging-techniques" class="nav-link">Advanced Logging Techniques</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#monitoring-message-flow" class="nav-link">Monitoring Message Flow</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#error-handling-with-logging" class="nav-link">Error Handling with Logging</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#configuring-logging" class="nav-link">Configuring Logging</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#best-practices-for-logging-and-monitoring" class="nav-link">Best Practices for Logging and Monitoring</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#next-steps" class="nav-link">Next Steps</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#conclusion" class="nav-link">Conclusion</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="logging-and-monitoring-in-ksml">Logging and Monitoring in KSML</h1>
<p>This tutorial guides you through implementing effective logging and monitoring in your KSML applications. By the end, you'll understand how to track your pipeline's behavior, debug issues, and monitor performance.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Basic understanding of KSML concepts</li>
<li>Completed the <a href="/docs/tutorials/beginner/simple-pipeline.md">Building a Simple Data Pipeline</a> tutorial</li>
<li>A running Kafka environment (as set up in the previous tutorial)</li>
</ul>
<h2 id="what-youll-learn">What You'll Learn</h2>
<p>In this tutorial, you'll learn how to:
1. Implement different levels of logging in KSML
2. Use the peek operation for monitoring message flow
3. Create custom monitoring functions
4. Configure logging settings
5. Implement basic error handling with logging</p>
<h2 id="understanding-logging-in-ksml">Understanding Logging in KSML</h2>
<p>KSML provides built-in logging capabilities through the <code>log</code> object, which is available in Python functions and expressions. The logging system follows standard logging levels:</p>
<ul>
<li><strong>ERROR</strong>: For error events that might still allow the application to continue running</li>
<li><strong>WARN</strong>: For potentially harmful situations</li>
<li><strong>INFO</strong>: For informational messages highlighting the progress of the application</li>
<li><strong>DEBUG</strong>: For detailed information, typically useful only when diagnosing problems</li>
<li><strong>TRACE</strong>: For even more detailed information than DEBUG</li>
</ul>
<h2 id="basic-logging-examples">Basic Logging Examples</h2>
<h3 id="step-1-create-a-ksml-file-with-logging">Step 1: Create a KSML File with Logging</h3>
<p>Create a file named <code>logging-example.yaml</code> with the following content:</p>
<pre><code class="language-yaml">streams:
  input_stream:
    topic: logging-input
    keyType: string
    valueType: json
  output_stream:
    topic: logging-output
    keyType: string
    valueType: json

functions:
  log_with_level:
    type: forEach
    parameters:
      - name: level
        type: string
      - name: message
        type: string
    code: |
      if level == &quot;ERROR&quot;:
        log.error(message)
      elif level == &quot;WARN&quot;:
        log.warn(message)
      elif level == &quot;INFO&quot;:
        log.info(message)
      elif level == &quot;DEBUG&quot;:
        log.debug(message)
      elif level == &quot;TRACE&quot;:
        log.trace(message)
      else:
        log.info(message)

pipelines:
  logging_pipeline:
    from: input_stream
    via:
      - type: peek
        forEach:
          functionRef: log_with_level
          args:
            level: &quot;INFO&quot;
            message: &quot;Received message with key: {} and value: {}&quot;
      - type: filter
        if:
          expression: value.get('importance') &gt; 3
      - type: peek
        forEach:
          functionRef: log_with_level
          args:
            level: &quot;DEBUG&quot;
            message: &quot;Message passed filter: {}&quot;
      - type: mapValues
        mapper:
          expression: dict(list(value.items()) + [(&quot;processed_at&quot;, time.time())])
      - type: peek
        forEach:
          code: |
            log.info(&quot;Sending processed message to output: {}&quot;, value)
    to: output_stream
</code></pre>
<p>This pipeline:
1. Logs every incoming message at INFO level
2. Filters messages based on an 'importance' field
3. Logs messages that pass the filter at DEBUG level
4. Adds a timestamp to each message
5. Logs the final processed message before sending it to the output topic</p>
<h3 id="step-2-create-kafka-topics">Step 2: Create Kafka Topics</h3>
<p>Create the input and output topics:</p>
<pre><code class="language-bash">docker-compose exec kafka kafka-topics --create --topic logging-input --bootstrap-server localhost:9092 --partitions 1 --replication-factor 1
docker-compose exec kafka kafka-topics --create --topic logging-output --bootstrap-server localhost:9092 --partitions 1 --replication-factor 1
</code></pre>
<h3 id="step-3-run-the-pipeline-with-different-log-levels">Step 3: Run the Pipeline with Different Log Levels</h3>
<p>Run the pipeline with different log levels to see how it affects the output:</p>
<pre><code class="language-bash"># Run with INFO level (default)
ksml-runner --config logging-example.yaml

# Run with DEBUG level to see more detailed logs
ksml-runner --config logging-example.yaml --log-level DEBUG

# Run with TRACE level to see all logs
ksml-runner --config logging-example.yaml --log-level TRACE
</code></pre>
<h3 id="step-4-produce-test-messages">Step 4: Produce Test Messages</h3>
<p>In a new terminal, produce some test messages:</p>
<pre><code class="language-bash">docker-compose exec kafka kafka-console-producer --topic logging-input --bootstrap-server localhost:9092 --property &quot;parse.key=true&quot; --property &quot;key.separator=:&quot;
</code></pre>
<p>Enter messages in the format <code>key:value</code>, for example:</p>
<pre><code>message1:{&quot;importance&quot;: 5, &quot;content&quot;: &quot;High importance message&quot;}
message2:{&quot;importance&quot;: 2, &quot;content&quot;: &quot;Low importance message&quot;}
message3:{&quot;importance&quot;: 4, &quot;content&quot;: &quot;Medium-high importance message&quot;}
</code></pre>
<h2 id="advanced-logging-techniques">Advanced Logging Techniques</h2>
<h3 id="creating-a-detailed-logging-function">Creating a Detailed Logging Function</h3>
<p>Add a more detailed logging function to your KSML file:</p>
<pre><code class="language-yaml">functions:
  detailed_logger:
    type: forEach
    parameters:
      - name: stage
        type: string
    code: |
      timestamp = time.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;)
      log.info(&quot;[{}] Stage: {} | Key: {} | Value Type: {} | Value: {}&quot;, 
               timestamp, stage, key, type(value).__name__, value)
</code></pre>
<p>Use this function in your pipeline:</p>
<pre><code class="language-yaml">- type: peek
  forEach:
    functionRef: detailed_logger
    args:
      stage: &quot;Pre-processing&quot;
</code></pre>
<h3 id="conditional-logging">Conditional Logging</h3>
<p>You can implement conditional logging to only log messages that meet certain criteria:</p>
<pre><code class="language-yaml">functions:
  conditional_logger:
    type: forEach
    code: |
      if &quot;error&quot; in value or value.get(&quot;status&quot;) == &quot;failed&quot;:
        log.error(&quot;Error detected in message: {}&quot;, value)
      elif value.get(&quot;importance&quot;, 0) &gt; 8:
        log.warn(&quot;High importance message detected: {}&quot;, value)
</code></pre>
<h2 id="monitoring-message-flow">Monitoring Message Flow</h2>
<h3 id="using-peek-for-monitoring">Using Peek for Monitoring</h3>
<p>The <code>peek</code> operation is a powerful tool for monitoring message flow without modifying the messages:</p>
<pre><code class="language-yaml">- type: peek
  forEach:
    code: |
      global message_count
      if 'message_count' not in globals():
        message_count = 0
      message_count += 1
      if message_count % 100 == 0:
        log.info(&quot;Processed {} messages&quot;, message_count)
</code></pre>
<h3 id="monitoring-processing-time">Monitoring Processing Time</h3>
<p>You can monitor how long operations take:</p>
<pre><code class="language-yaml">functions:
  time_operation:
    type: mapper
    parameters:
      - name: operation_name
        type: string
    code: |
      start_time = time.time()
      result = yield
      end_time = time.time()
      log.info(&quot;Operation '{}' took {:.3f} ms&quot;, operation_name, (end_time - start_time) * 1000)
      return result
</code></pre>
<p>Use this function to wrap operations:</p>
<pre><code class="language-yaml">- type: process
  processor:
    functionRef: time_operation
    args:
      operation_name: &quot;Complex Transformation&quot;
    next:
      - type: mapValues
        mapper:
          expression: # Your complex transformation here
</code></pre>
<h2 id="error-handling-with-logging">Error Handling with Logging</h2>
<h3 id="catching-and-logging-errors">Catching and Logging Errors</h3>
<p>Use try-except blocks in your Python functions to catch and log errors:</p>
<pre><code class="language-yaml">functions:
  safe_transform:
    type: mapper
    code: |
      try:
        # Attempt the transformation
        result = {&quot;processed&quot;: value.get(&quot;data&quot;) * 2, &quot;status&quot;: &quot;success&quot;}
        return result
      except Exception as e:
        # Log the error and return a fallback value
        log.error(&quot;Error processing message: {} - Error: {}&quot;, value, str(e))
        return {&quot;processed&quot;: None, &quot;status&quot;: &quot;error&quot;, &quot;error_message&quot;: str(e)}
</code></pre>
<h2 id="configuring-logging">Configuring Logging</h2>
<h3 id="log-configuration-in-ksml-runner">Log Configuration in KSML Runner</h3>
<p>The KSML Runner supports various logging configuration options:</p>
<pre><code class="language-bash"># Set log level
ksml-runner --config your-pipeline.yaml --log-level INFO

# Log to a file
ksml-runner --config your-pipeline.yaml --log-file pipeline.log

# Configure log format
ksml-runner --config your-pipeline.yaml --log-format &quot;%(asctime)s [%(levelname)s] %(message)s&quot;
</code></pre>
<h2 id="best-practices-for-logging-and-monitoring">Best Practices for Logging and Monitoring</h2>
<ol>
<li><strong>Use appropriate log levels</strong>:</li>
<li>ERROR: For actual errors that need attention</li>
<li>WARN: For potential issues or unusual conditions</li>
<li>INFO: For normal but significant events</li>
<li>DEBUG: For detailed troubleshooting information</li>
<li>
<p>TRACE: For very detailed debugging information</p>
</li>
<li>
<p><strong>Include context in log messages</strong>:</p>
</li>
<li>Message keys and values (or summaries for large values)</li>
<li>Operation or stage name</li>
<li>Timestamps</li>
<li>
<p>Relevant metrics or counters</p>
</li>
<li>
<p><strong>Avoid excessive logging</strong>:</p>
</li>
<li>Don't log every message at high volume</li>
<li>Use sampling or periodic logging for high-throughput pipelines</li>
<li>
<p>Consider conditional logging based on message content</p>
</li>
<li>
<p><strong>Structure your logs</strong>:</p>
</li>
<li>Use consistent formats</li>
<li>Include key-value pairs for easier parsing</li>
<li>
<p>Consider using JSON formatting for machine-readable logs</p>
</li>
<li>
<p><strong>Monitor performance metrics</strong>:</p>
</li>
<li>Message throughput</li>
<li>Processing time</li>
<li>Error rates</li>
<li>Resource usage (memory, CPU)</li>
</ol>
<h2 id="next-steps">Next Steps</h2>
<p>Now that you've learned about logging and monitoring in KSML, you can:</p>
<ul>
<li>Explore <a href="/docs/tutorials/intermediate/index.md">intermediate tutorials</a> to learn about more advanced KSML features</li>
<li>Learn about <a href="/docs/tutorials/intermediate/error-handling.md">error handling and recovery</a> in more detail</li>
<li>Dive into <a href="/docs/tutorials/advanced/performance-optimization.md">performance optimization</a> techniques</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>Effective logging and monitoring are essential for building robust KSML applications. By implementing the techniques covered in this tutorial, you'll be able to:</p>
<ul>
<li>Track the behavior of your pipelines</li>
<li>Quickly identify and diagnose issues</li>
<li>Monitor performance and resource usage</li>
<li>Create more maintainable and reliable applications</li>
</ul>
<p>Remember that good logging practices are a balance between capturing enough information to be useful and avoiding excessive logging that can impact performance.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js"></script>
        <script src="../../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
